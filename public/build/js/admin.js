function e(){t(),o(),n(),r(),d()}function t(){const e=document.querySelector("#fecha");if(e){e.addEventListener("input",(function(e){const t=e.target.value;window.location="?fecha="+t}));const t=document.querySelector('a[href="/admin"]');t&&t.addEventListener("click",(function(t){t.preventDefault(),e.value="",window.location="/admin"}))}}function o(){document.querySelectorAll(".estado-cita").forEach(e=>{e.addEventListener("change",(async function(e){const t=this.dataset.citaId,o=this.value;try{const e=new FormData;e.append("id",t),e.append("estado",o);const n="/api/citas/estado",r=await fetch(n,{method:"POST",body:e});if("exito"===(await r.json()).tipo){const e=this.closest(".border").querySelector(".estado-badge");e.classList.remove("bg-yellow-100","text-yellow-800","bg-blue-100","text-blue-800","bg-green-100","text-green-800","bg-red-100","text-red-800");const t={pendiente:["bg-yellow-100","text-yellow-800"],confirmada:["bg-blue-100","text-blue-800"],completada:["bg-green-100","text-green-800"],cancelada:["bg-red-100","text-red-800"]};e.classList.add(...t[o]),e.textContent=o.charAt(0).toUpperCase()+o.slice(1),Swal.fire({icon:"success",title:"Estado Actualizado",text:"El estado de la cita se actualizó correctamente",showConfirmButton:!1,timer:1500}),setTimeout(()=>{window.location.reload()},1500)}}catch(e){console.error(e),Swal.fire({icon:"error",title:"Error",text:"Hubo un error al actualizar el estado"})}}))})}function n(){const e=document.querySelectorAll(".tab-btn"),t=document.querySelectorAll(".tab-content");e.forEach(o=>{o.addEventListener("click",(function(){e.forEach(e=>{e.classList.remove("border-blue-500","text-blue-600"),e.classList.add("border-transparent","text-gray-500")}),t.forEach(e=>{e.classList.add("hidden")}),this.classList.remove("border-transparent","text-gray-500"),this.classList.add("border-blue-500","text-blue-600");const o=this.dataset.tab,n=document.querySelector(`#${o}-tab`);n&&n.classList.remove("hidden")}))})}function r(){const e=document.querySelector("#nuevo-servicio");e&&e.addEventListener("click",a);document.querySelectorAll(".editar-servicio").forEach(e=>{e.addEventListener("click",(function(){l(this.dataset.id)}))});document.querySelectorAll(".eliminar-servicio").forEach(e=>{e.addEventListener("click",(function(){c(this.dataset.id)}))})}function a(e={}){Swal.fire({title:e.id?"Editar Servicio":"Nuevo Servicio",html:`\n            <form id="formulario-servicio" class="space-y-4">\n                <input type="hidden" name="id" value="${e.id||""}">\n                <div>\n                    <label class="block text-sm font-medium text-gray-700">Nombre del Servicio</label>\n                    <input type="text" name="nombre_servicio" \n                           class="mt-1 block w-full rounded-md border-gray-300" \n                           value="${e.nombre_servicio||""}" \n                           required \n                           minlength="3"\n                           \n                           title="Solo se permiten letras y espacios">\n                </div>\n                <div>\n                    <label class="block text-sm font-medium text-gray-700">Precio</label>\n                    <input type="number" name="precio" \n                           class="mt-1 block w-full rounded-md border-gray-300" \n                           value="${e.precio||""}" \n                           required \n                           min="3000"\n                           max="100000"\n                           step="1">\n                </div>\n                <div>\n                    <label class="block text-sm font-medium text-gray-700">Tiempo Estimado (minutos)</label>\n                    <input type="number" name="tiempo_estimado" \n                           class="mt-1 block w-full rounded-md border-gray-300" \n                           value="${e.tiempo_estimado||""}" \n                           required \n                           min="1"\n                           step="1">\n                </div>\n            </form>\n        `,showCancelButton:!0,confirmButtonText:e.id?"Actualizar":"Crear",cancelButtonText:"Cancelar",preConfirm:()=>{const t=document.getElementById("formulario-servicio");if(!t.checkValidity())return t.reportValidity(),!1;return i(new FormData(t),e.id)}})}async function i(e,t){try{const o=t?"/api/servicios/actualizar":"/api/servicios/crear",n=await fetch(o,{method:"POST",body:e}),r=await n.json();"exito"===r.tipo?(Swal.fire("¡Éxito!",r.mensaje,"success"),setTimeout(()=>{window.location.reload()},1500)):Swal.fire("Error",r.mensaje,"error")}catch(e){console.error(e),Swal.fire("Error","Hubo un error al procesar la solicitud","error")}}async function l(e){try{const t=await fetch("/api/servicios/"+e);a(await t.json())}catch(e){console.error(e),Swal.fire("Error","No se pudo cargar el servicio","error")}}function c(e){Swal.fire({title:"¿Estás seguro?",text:"Esta acción no se puede revertir",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&s(e)})}async function s(e){try{const t=new FormData;t.append("id",e);const o=await fetch("/api/servicios/eliminar",{method:"POST",body:t}),n=await o.json();"exito"===n.tipo?(Swal.fire("¡Eliminado!",n.mensaje,"success"),setTimeout(()=>{window.location.reload()},1500)):Swal.fire("Error",n.mensaje,"error")}catch(e){console.error(e),Swal.fire("Error","Hubo un error al eliminar el servicio","error")}}function d(){document.querySelectorAll(".ver-usuario").forEach(e=>{e.addEventListener("click",(async function(){const e=this.dataset.id;try{const t=await fetch("/api/usuarios?id="+e),o=await t.json();if(o){const e=`${o.nombre||""} ${o.apellido||""}`.trim(),t=o.fecha_creacion?new Date(o.fecha_creacion).toLocaleDateString():"No disponible",n=o.ultima_actualizacion?new Date(o.ultima_actualizacion).toLocaleDateString():"No disponible";Swal.fire({title:"Detalles del Usuario",html:`\n                            <div class="text-left">\n                                <p class="mb-2"><strong>Nombre:</strong> ${e||"No disponible"}</p>\n                                <p class="mb-2"><strong>Email:</strong> ${o.email||"No disponible"}</p>\n                                <p class="mb-2"><strong>Teléfono:</strong> ${o.telefono||"No disponible"}</p>\n                                <p class="mb-2"><strong>Estado:</strong> ${o.confirmado?"Confirmado":"Pendiente"}</p>\n                                <p class="mb-2"><strong>Rol:</strong> ${o.admin?"Administrador":"Cliente"}</p>\n                                <p class="mb-2"><strong>Fecha de registro:</strong> ${t}</p>\n                                <p class="mb-2"><strong>Última actualización:</strong> ${n}</p>\n                            </div>\n                        `,confirmButtonText:"Cerrar",customClass:{confirmButton:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors"}})}}catch(e){console.error("Error:",e),Swal.fire({icon:"error",title:"Error",text:"No se pudo cargar la información del usuario"})}}))});document.querySelectorAll(".editar-usuario").forEach(e=>{e.addEventListener("click",(async function(){const e=this.dataset.id;try{const t=await fetch("/api/usuarios?id="+e),o=await t.json();o&&u(o)}catch(e){console.error("Error:",e),Swal.fire({icon:"error",title:"Error",text:"No se pudo cargar la información del usuario"})}}))});document.querySelectorAll(".eliminar-usuario").forEach(e=>{e.addEventListener("click",(function(){const e=this.dataset.id;Swal.fire({title:"¿Estás seguro?",text:"Esta acción eliminará al usuario y todas sus citas. No podrás revertir esto.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&f(e)})}))})}function u(e){Swal.fire({title:"Editar Usuario",html:`\n            <form id="formulario-usuario" class="space-y-4">\n                <input type="hidden" name="id" value="${e.id}">\n                <div>\n                    <label class="block text-sm font-medium text-gray-700">Nombre</label>\n                    <input type="text" name="nombre" \n                           class="mt-1 block w-full rounded-md border-gray-300" \n                           value="${e.nombre||""}" \n                           required>\n                </div>\n                <div>\n                    <label class="block text-sm font-medium text-gray-700">Apellido</label>\n                    <input type="text" name="apellido" \n                           class="mt-1 block w-full rounded-md border-gray-300" \n                           value="${e.apellido||""}" \n                           required>\n                </div>\n                <div>\n                    <label class="block text-sm font-medium text-gray-700">Email</label>\n                    <input type="email" name="email" \n                           class="mt-1 block w-full rounded-md border-gray-300" \n                           value="${e.email||""}" \n                           required>\n                </div>\n                <div>\n                    <label class="block text-sm font-medium text-gray-700">Teléfono</label>\n                    <input type="tel" name="telefono" \n                           class="mt-1 block w-full rounded-md border-gray-300" \n                           value="${e.telefono||""}" \n                           required \n                           pattern="[0-9]{9}">\n                </div>\n                <div>\n                    <label class="block text-sm font-medium text-gray-700">Estado de la cuenta</label>\n                    <select name="confirmado" \n                            class="mt-1 block w-full rounded-md border-gray-300">\n                        <option value="0" ${e.confirmado?"":"selected"}>Pendiente</option>\n                        <option value="1" ${e.confirmado?"selected":""}>Confirmada</option>\n                    </select>\n                </div>\n            </form>\n        `,showCancelButton:!0,confirmButtonText:"Actualizar",cancelButtonText:"Cancelar",preConfirm:()=>{const e=document.getElementById("formulario-usuario");if(!e.checkValidity())return e.reportValidity(),!1;return m(new FormData(e))}})}async function m(e){try{const t=await fetch("/api/usuarios/actualizar",{method:"POST",body:e}),o=await t.json();"exito"===o.tipo?(Swal.fire({icon:"success",title:"¡Usuario actualizado!",text:o.mensaje,showConfirmButton:!1,timer:1500}),setTimeout(()=>{window.location.reload()},1500)):Swal.fire({icon:"error",title:"Error",text:o.mensaje})}catch(e){console.error(e),Swal.fire({icon:"error",title:"Error",text:"Hubo un error al actualizar el usuario"})}}async function f(e){try{const t=new FormData;t.append("id",e);const o=await fetch("/api/usuarios/eliminar",{method:"POST",body:t}),n=await o.json();"exito"===n.tipo?(Swal.fire({icon:"success",title:"¡Usuario eliminado!",text:n.mensaje,showConfirmButton:!1,timer:1500}),setTimeout(()=>{window.location.reload()},1500)):Swal.fire({icon:"error",title:"Error",text:n.mensaje})}catch(e){console.error(e),Swal.fire({icon:"error",title:"Error",text:"Hubo un error al eliminar el usuario"})}}document.addEventListener("DOMContentLoaded",(function(){e()}));
//# sourceMappingURL=admin.js.map
